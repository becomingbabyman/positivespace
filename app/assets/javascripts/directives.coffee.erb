psDirectives = angular.module 'psDirectives', []

# placeholder:	String - REQUIRED
# model:      	String - REQUIRED
# form:       	String - REQUIRED
# type:       	String - default 'text'
# name:       	String - default placeholder
# title:      	String - default placeholder
# class:      	String - default null
# label:      	String - default null
# helpInline: 	String - default null
# helpBlock:  	String - default null
# TODO: should required be an attribute?
psDirectives.directive 'bsInput', () ->
	# TODO: get a placeholder plugin to patch old browsers and behave like https://github.com/wduffy/jLabel -- probably just write a directive for the 'placeholder' attribute
	# TODO: handle non text inputs gracefully

	directiveDefinitionObject =
		restrict: 'A'
		scope:
			placeholder: '@'
			model: '='
			form:  '='
		templateUrl: "<%= asset_path('directives/ps_input.html') %>"
		replace: true

		link: (scope, element, attrs) ->
			window.s or= []
			window.s.push scope

			scope.hasLabel = attrs.label?
			scope.hasHelpInline = attrs.helpInline?
			scope.hasHelpBlock = attrs.helpBlock?

			scope.type or= attrs.type or= 'text'
			scope.name or= attrs.name or= scope.placeholder
			scope.title or= attrs.title or= attrs.placeholder
			scope.class or= attrs.class or= null
			scope.formInput or= {$invalid: true, $error: 'TODO:'} # scope.form[scope.name]
			# scope.required = (if attrs.required == undefined then '' else 'required')
			scope.label or= attrs.label or= null
			scope.helpInline or= attrs.helpInline or= null
			scope.helpBlock or= attrs.helpBlock or= null

			scope.focused = false
			scope.focusin = ->
				scope.focused = true

			scope.focusout = ->
				scope.focused = false


	return directiveDefinitionObject



ps.controller "SearchsHeaderCtrl", ["$scope", "$http", "$location", ($scope, $http, $location) ->
	$scope.users = []

	$scope.search = (query) ->
		$scope.loading = true
		return $http.get("/api/users?q=#{query}").then (response) ->
			$scope.loading = false
			$scope.users = response.data
			response.data.collection
		, (error) ->
			$scope.loading = false

	# TODO: REFACTOR: This is a crappy way to select a search result. Find a better way.
	$scope.$watch 'query', (query) ->
		if _.isObject(query) and query.slug?
			$location.path("/#{query.slug}")
			q = angular.copy $scope.query
			$scope.query = null
			analytics.track "search success",
				username: q.username
				id: q.id
]

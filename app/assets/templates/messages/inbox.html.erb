<div id='inbox' class="container">

	<div class="row">
		<div class="span-mobile center">
			<div class="row-fluid" ng-repeat="conversation in conversations">
				<div class="span12">
					<div class="row-fluid">
						<div class="span12">
							{{conversation.from.name}} ->
							{{conversation.to.name}}
						</div>
					</div>
					<div class="row-fluid">
						<div class="span12">
							{{conversation.created_at}}
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div ng-show='currentMessage' class="row">
		<div class="span-mobile center">

			<div class="row-fluid" ng-repeat="message in currentThread">
				{{message.id == currentMessage.id}}
				{{message.id}}
				{{currentMessage.id}}
				<div class="span12" ng-show='show.thread || message.id == currentMessage.id'>
					<div class="row-fluid">
						<div class="span12 uncenter">
							<img ng-src="{{message.from.avatar.thumb_url}}" alt="{{message.from.name}}" class="img-circle img-mini">
							<small>{{message.from.name}}</small>
						</div>
					</div>

					<div class="row-fluid">
						<div class="span12">
							<p class='pts pbm' ng-bind-html-unsafe="message.body | linebreaks">{{message.body}}</p>
						</div>
					</div>
				</div>
			</div>

			<div class="row-fluid">
				<div class="span12 pbm">
					<a href='#' ng-show='currentThread.length > 1' ng-hide='show.thread' class='btn btn-block btn-link unfancy-link' ng-click='show.thread = true'>expand conversation</a>
					<a href='#' ng-show='show.thread' class='btn btn-block btn-link unfancy-link' ng-click='show.thread = false'>collapse conversation</a>
				</div>
			</div>

			<div ui-if='lastMsgInThread || show.thread' class="row-fluid reply">
				<div class="span12">
					<!-- <a href="#" class="reply pull-right">reply</a> -->

					<form name='replyForm' class='reply' ng-submit="save('send')" novalidate style='width: 100%;'>
						<control-group>
							<textarea name='body' cols="30" rows="4" ng-model='myMessage.body' id='response_body' placeholder='your response' class='input-block-level' required></textarea>
						</control-group>

						<div class='control-group'>
							<div class='controls'>
								<button type='submit' class='btn btn-success pull-right' ng-disabled="replyForm.body.$invalid">Reply</button>

								<span class='pull-right'>&nbsp;&nbsp;</span>
								<a href='#' class='btn pull-right' ng-disabled='savedBody == myMessage.body' ng-click='save()'>Save Draft</a>

								<span class='pull-right pts prm' ng-class='{"muted": remainingChars > 10, "text-error": remainingChars <= 10}'>{{remainingChars}}</span>

								<a href='#' class='btn btn-inverse pull-left' ng-click='endConvo()' tooltip="End a conversation if it's going nowhere. You can always start a new one." tooltip-placement='right'>End</a>
							</div>
						</div>
					</form>

				</div>
			</div>

		</div>
	</div>

</div>

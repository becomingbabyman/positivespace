<div id='conversations' class="container pbl">

	<div class="row ptl">
		<div class="span-mobile center">
			<div class="row-fluid faded">
				<div class="span12">
					conversations
				</div>
			</div>
			<div class="row-fluid">
				<a href="#" ng-click='filter("ready")'>
					<div class="span4 faded" tooltip="{{selectedFilter != 'ready' && 'Show Ready' || 'Show All'}}">
						<i class="icon-circle-blank color-green prs" ng-class="{opacity5: selectedFilter != 'ready'}"></i>
						{{app.currentUser.ready_conversations_count}}
					</div>
				</a>
				<a href="#" ng-click='filter("waiting")'>
					<div class="span4 faded" tooltip="{{selectedFilter != 'waiting' && 'Show Waiting' || 'Show All'}}">
						<i class="icon-time color-yellow prs" ng-class="{opacity5: selectedFilter != 'waiting'}"></i>
						{{app.currentUser.waiting_conversations_count}}
					</div>
				</a>
				<a href="#" ng-click='filter("ended")'>
					<div class="span4 faded" tooltip="{{selectedFilter != 'ended' && 'Show Ended' || 'Show All'}}">
						<i class="icon-remove-circle color-red prs" ng-class="{opacity5: selectedFilter != 'ended'}"></i>
						{{app.currentUser.ended_conversations_count}}
					</div>
				</a>
			</div>
			<div class="row-fluid">
				<div class="span12" ng-show='conversations.length == 0'>
					<h3 class='faded'>You should start one.</h3>
				</div>
			</div>
			<div class="row-fluid" ng-repeat="conversation in conversations">
				<div class="span12">
					<hr/>
					<a ng-href="/conversations/{{conversation.id}}?message_id={{conversation.last_message_id}}" class='unfancy-link'>
						<div class="row-fluid">
							<div class="span12">
								<small class='pull-right faded'>{{conversation.updated_at | date:"MMMM d, yyyy"}}</small>
								<i class="icon-circle-blank opacity5 color-green pull-left" ng-show="conversation.state == 'in_progress' && conversation.last_message_from_id != app.currentUser.id" tooltip="Reply now!"></i>
								<i class="icon-time opacity5 color-yellow pull-left" ng-show="conversation.state == 'in_progress' && conversation.last_message_from_id == app.currentUser.id" tooltip="Wait for a reply."></i>
								<i class="icon-remove-circle opacity5 color-red pull-left" ng-show="conversation.state == 'ended'" tooltip="All done."></i>
							</div>
						</div>
						<!-- <div class="row-fluid">
							<div class="span12">
								<small>{{conversation.prompt}}</small>
							</div>
						</div> -->
						<div class="row-fluid">
							<div class="span12">
								<img ng-src="{{conversation.from.avatar.thumb_url}}" alt="{{conversation.from.name}}" class="img-circle img-border img-mini">
								<img ng-src="{{conversation.to.avatar.thumb_url}}" alt="{{conversation.to.name}}" class="img-circle img-border" tooltip="{{conversation.prompt}}" tooltip-placement='bottom'>
							</div>
						</div>
						<div class="row-fluid ptm">
							<div class="span12">
								<small ng-hide='conversation.from.id == app.currentUser.id'>from</small>
								<small ng-hide='conversation.to.id == app.currentUser.id'>to</small>
								<span ng-hide='conversation.from.id == app.currentUser.id'>{{conversation.from.name}}</span>
								<span ng-hide='conversation.to.id == app.currentUser.id'>{{conversation.to.name}}</span>
							</div>
						</div>
						<div class="row-fluid">
							<div class="span12">
								<p class='lead' ng-bind-html-unsafe="conversation.last_message_body | linebreaks">{{conversation.last_message_body}}</p>
							</div>
						</div>
						<div class="row-fluid" ng-show="conversation.state != 'ended' && conversation.last_message_from_id != app.currentUser.id">
							<div class="span12">
								<div class='btn btn-link btn-block' ng-click='selectConversation(conversation)'>reply</div>
							</div>
						</div>
					</a>
				</div>
			</div>
		</div>
	</div>

</div>
